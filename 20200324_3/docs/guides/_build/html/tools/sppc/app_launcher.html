

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.5. App Container Launchers &mdash; Soft Patch Panel 19.08 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.6. Use Cases" href="usecases.html" />
    <link rel="prev" title="1.4. Build Images" href="build_img.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Soft Patch Panel
          

          
          </a>

          
            
            
              <div class="version">
                19.08
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../design/index.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gsg/index.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../commands/index.html">SPP Commands</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tools</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">1. SPP Container</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">1.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting_started.html">1.2. Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">1.3. Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="build_img.html">1.4. Build Images</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">1.5. App Container Launchers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup">1.5.1. Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spp-primary-container">1.5.2. SPP Primary Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spp-secondary-container">1.5.3. SPP Secondary Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l2fwd-container">1.5.4. L2fwd Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l3fwd-container">1.5.5. L3fwd Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#l3fwd-acl-container">1.5.6. L3fwd-acl Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testpmd-container">1.5.7. Testpmd Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pktgen-dpdk-container">1.5.8. Pktgen-dpdk Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-balancer-container">1.5.9. Load-Balancer Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suricata-container">1.5.10. Suricata Container</a></li>
<li class="toctree-l4"><a class="reference internal" href="#helloworld-container">1.5.11. Helloworld Container</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="usecases.html">1.6. Use Cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="howto_launcher.html">1.7. How to Define Your App Launcher</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../helpers/index.html">2. Helper tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_ref/index.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Soft Patch Panel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tools</a> &raquo;</li>
        
          <li><a href="index.html">1. SPP Container</a> &raquo;</li>
        
      <li>1.5. App Container Launchers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tools/sppc/app_launcher.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="app-container-launchers">
<span id="spp-container-app-launcher"></span><h1>1.5. App Container Launchers<a class="headerlink" href="#app-container-launchers" title="Permalink to this headline">¶</a></h1>
<p>App container launcher is a python script for running SPP or DPDK
application on a container.
As described by name, for instance, <code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> launches pktgen-dpdk
inside a container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tree app/
<span class="go">app/</span>
<span class="go">...</span>
<span class="go">|--- helloworld.py</span>
<span class="go">|--- l2fwd.py</span>
<span class="go">|--- l3fwd.py</span>
<span class="go">|--- l3fwd-acl.py</span>
<span class="go">|--- load-balancer.py</span>
<span class="go">|--- pktgen.py</span>
<span class="go">|--- spp-nfv.py</span>
<span class="go">|--- spp-primary.py</span>
<span class="go">|--- suricata.py</span>
<span class="go">---- testpmd.py</span>
</pre></div>
</div>
<div class="section" id="setup">
<span id="sppc-appl-setup"></span><h2>1.5.1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>You should define <code class="docutils literal notranslate"><span class="pre">SPP_CTL_IP</span></code> environment variable to SPP controller
be accessed from other SPP processes inside containers.
SPP controller is a CLI tool for accepting user’s commands.</p>
<p>You cannot use <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or <code class="docutils literal notranslate"><span class="pre">localhost</span></code> for <code class="docutils literal notranslate"><span class="pre">SPP_CTL_IP</span></code>
because SPP processes try to find SPP controller inside each of
containers and fail to.
From inside of the container, SPP processes should be known IP address
other than <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> or <code class="docutils literal notranslate"><span class="pre">localhost</span></code>
of host on which SPP controller running.</p>
<p>SPP controller should be launched before other SPP processes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp
<span class="gp">$</span> python3 src/spp.py
</pre></div>
</div>
</div>
<div class="section" id="spp-primary-container">
<span id="sppc-appl-spp-primary"></span><h2>1.5.2. SPP Primary Container<a class="headerlink" href="#spp-primary-container" title="Permalink to this headline">¶</a></h2>
<p>SPP primary process is launched from <code class="docutils literal notranslate"><span class="pre">app/spp-primary.py</span></code> as an
app container.
It manages resources on host from inside the container.
<code class="docutils literal notranslate"><span class="pre">app/spp-primary.py</span></code> calls <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> with
<code class="docutils literal notranslate"><span class="pre">-v</span></code> option to mount hugepages and other devices in the container
to share them between host and containers.</p>
<p>SPP primary process is launched as foreground or background mode.
You can show statistics of packet forwarding if you launch it with
two cores and in foreground mode.
In this case, SPP primary uses one for resource management and
another one for showing statistics.
If you need to minimize the usage of cores, or are not interested in
the statistics,
you should give just one core and run in background mode.
If you run SPP primary in foreground mode with one core,
it shows log messages which is also referred in syslog.</p>
<p>Here is an example for launching SPP primary with core list 0-1 in
foreground mode.
You should give portmask opiton <code class="docutils literal notranslate"><span class="pre">-p</span></code> because SPP primary requires
at least one port, or failed to launch.
This example is assumed that host machine has two or more
physical ports.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/spp-primary -l <span class="m">0</span>-1 -p 0x03 -fg
</pre></div>
</div>
<p>It is another example with one core and two ports in background mode.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/spp-primary -l <span class="m">0</span> -p 0x03
</pre></div>
</div>
<p>SPP primary is able to run with virtual devices instead of physical NICs
for a case you do not have dedicated NICs for DPDK.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/spp-primary -l <span class="m">0</span> -d vhost:1,vhost:2 -p 0x03
</pre></div>
</div>
<p>If you need to inspect a docker command without launching
a container, use <code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> option.
It composes docker command and just display it without running the
docker command.</p>
<p>You refer all of options with <code class="docutils literal notranslate"><span class="pre">-h</span></code> option.
Options of app container scripts are categorized four types.
First one is EAL option, for example <code class="docutils literal notranslate"><span class="pre">-l</span></code>, <code class="docutils literal notranslate"><span class="pre">-c</span></code> or <code class="docutils literal notranslate"><span class="pre">-m</span></code>.
Second one is app container option which is a common set of options for
app containers connected with SPP. So, containers of SPP processes do
not have app container option.
Third one is application specific option. In this case,
<code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">-ip</span></code>.
Final one is container option, for example <code class="docutils literal notranslate"><span class="pre">--dist-name</span></code> or
<code class="docutils literal notranslate"><span class="pre">--ci</span></code>.
EAL options and container options are common for all of app container
scripts.
On the other hand, application specific options are different each other.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/spp-primary.py -h
<span class="go">usage: spp-primary.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                      [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                      [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                      [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                      [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                      [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]]</span>
<span class="go">                      [-nq NOF_QUEUES] [--no-privileged] [-n NOF_RING]</span>
<span class="go">                      [-p PORT_MASK] [-ip CTL_IP] [--ctl-port CTL_PORT]</span>
<span class="go">                      [--dist-name DIST_NAME] [--dist-ver DIST_VER]</span>
<span class="go">                      [--workdir WORKDIR] [--name NAME] [-ci CONTAINER_IMAGE]</span>
<span class="go">                      [-fg] [--dry-run]</span>

<span class="go">Launcher for spp-primary application container</span>

<span class="go">optional arguments:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  -l CORE_LIST, --core-list CORE_LIST</span>
<span class="go">                        Core list</span>
<span class="go">  -c CORE_MASK, --core-mask CORE_MASK</span>
<span class="go">                        Core mask</span>
<span class="go">  -m MEM, --mem MEM     Memory size (default is 1024)</span>
<span class="go">  --vdev [VDEV [VDEV ...]]</span>
<span class="go">                        Virtual device in the format of DPDK</span>
<span class="go">  --socket-mem SOCKET_MEM</span>
<span class="go">                        Memory size</span>
<span class="go">  -b [PCI_BLACKLIST [PCI_BLACKLIST ...]], --pci-blacklist [PCI_BLACKLIST...</span>
<span class="go">                        PCI blacklist for excluding devices</span>
<span class="go">  -w [PCI_WHITELIST [PCI_WHITELIST ...]], --pci-whitelist [PCI_WHITELIST...</span>
<span class="go">                        PCI whitelist for including devices</span>
<span class="go">  --single-file-segments</span>
<span class="go">                        Create fewer files in hugetlbfs (non-legacy mode</span>
<span class="go">                        only).</span>
<span class="go">  --nof-memchan NOF_MEMCHAN</span>
<span class="go">                        Number of memory channels (default is 4)</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -v [VOLUME [VOLUME ...]], --volume [VOLUME [VOLUME ...]]</span>
<span class="go">                        Bind mount a volume (for docker)</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -n NOF_RING, --nof-ring NOF_RING</span>
<span class="go">                        Maximum number of Ring PMD</span>
<span class="go">  -p PORT_MASK, --port-mask PORT_MASK</span>
<span class="go">                        Port mask</span>
<span class="go">  -ip CTL_IP, --ctl-ip CTL_IP</span>
<span class="go">                        IP address of spp-ctl</span>
<span class="go">  --ctl-port CTL_PORT   Port for primary of spp-ctl</span>
<span class="go">  --dist-name DIST_NAME</span>
<span class="go">                        Name of Linux distribution</span>
<span class="go">  --dist-ver DIST_VER   Version of Linux distribution</span>
<span class="go">  --workdir WORKDIR     Path of directory in which the command is launched</span>
<span class="go">  --name NAME           Name of container</span>
<span class="go">  -ci CONTAINER_IMAGE, --container-image CONTAINER_IMAGE</span>
<span class="go">                        Name of container image</span>
<span class="go">  -fg, --foreground     Run container as foreground mode</span>
<span class="go">  --dry-run             Only print matrix, do not run, and exit</span>
</pre></div>
</div>
</div>
<div class="section" id="spp-secondary-container">
<span id="sppc-appl-spp-secondary"></span><h2>1.5.3. SPP Secondary Container<a class="headerlink" href="#spp-secondary-container" title="Permalink to this headline">¶</a></h2>
<p>In SPP, there are three types of secondary process, <code class="docutils literal notranslate"><span class="pre">spp_nfv</span></code>,
<code class="docutils literal notranslate"><span class="pre">spp_vf</span></code> or so.
However, SPP container does only support <code class="docutils literal notranslate"><span class="pre">spp_nfv</span></code> currently.</p>
<p><code class="docutils literal notranslate"><span class="pre">spp-nfv.py</span></code> launches <code class="docutils literal notranslate"><span class="pre">spp_nfv</span></code> as an app container and requires
options for secondary ID and core list (or core mask).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/spp-nfv.py -i <span class="m">1</span> -l <span class="m">2</span>-3
</pre></div>
</div>
<p>Refer help for all of options and usges.
It shows only application specific options for simplicity.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/spp-nfv.py -h
<span class="go">usage: spp-nfv.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                  [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                  [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                  [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                  [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                  [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]] [-nq NOF_QUEUES]</span>
<span class="go">                  [--no-privileged] [-i SEC_ID] [-ip CTL_IP]</span>
<span class="go">                  [--ctl-port CTL_PORT] [--dist-name DIST_NAME]</span>
<span class="go">                  [--dist-ver DIST_VER] [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                  [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for spp-nfv application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -i SEC_ID, --sec-id SEC_ID</span>
<span class="go">                        Secondary ID</span>
<span class="go">  -ip CTL_IP, --ctl-ip CTL_IP</span>
<span class="go">                        IP address of spp-ctl</span>
<span class="go">  --ctl-port CTL_PORT   Port for secondary of spp-ctl</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="l2fwd-container">
<span id="sppc-appl-l2fwd"></span><h2>1.5.4. L2fwd Container<a class="headerlink" href="#l2fwd-container" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">app/l2fwd.py</span></code> is a launcher script for DPDK <code class="docutils literal notranslate"><span class="pre">l2fwd</span></code> sample
application.
It launches <code class="docutils literal notranslate"><span class="pre">l2fwd</span></code> on a container with specified
vhost interfaces.</p>
<p>This is an example for launching with two cores (6-7th cores) with
<code class="docutils literal notranslate"><span class="pre">-l</span></code> and two vhost interfaces with <code class="docutils literal notranslate"><span class="pre">-d</span></code>.
<code class="docutils literal notranslate"><span class="pre">l2fwd</span></code> requires <code class="docutils literal notranslate"><span class="pre">--port-mask</span></code> or <code class="docutils literal notranslate"><span class="pre">-p</span></code> option and the number of
ports should be even number.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/l2fwd.py -l <span class="m">6</span>-7 -d vhost:1,vhost:2 -p 0x03 -fg
<span class="go">...</span>
</pre></div>
</div>
<p>Refer help for all of options and usges.
It includes app container options, for example <code class="docutils literal notranslate"><span class="pre">-d</span></code> for vhost devices
and <code class="docutils literal notranslate"><span class="pre">-nq</span></code> for the number of queues of virtio, because <code class="docutils literal notranslate"><span class="pre">l2fwd</span></code> is not
a SPP process.
It shows options without of EAL and container for simplicity.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/l2fwd.py -h
<span class="go">usage: l2fwd.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]] [-nq NOF_QUEUES]</span>
<span class="go">                [--no-privileged] [-p PORT_MASK] [--dist-name DIST_NAME]</span>
<span class="go">                [--dist-ver DIST_VER] [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for l2fwd application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -p PORT_MASK, --port-mask PORT_MASK</span>
<span class="go">                        Port mask</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="l3fwd-container">
<span id="sppc-appl-l3fwd"></span><h2>1.5.5. L3fwd Container<a class="headerlink" href="#l3fwd-container" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://dpdk.org/doc/guides/sample_app_ug/l3_forward.html">L3fwd</a>
application is a simple example of packet processing
using the DPDK.
Differed from l2fwd, the forwarding decision is made based on
information read from input packet.
This application provides LPM (longest prefix match) or
EM (exact match) methods for packet classification.</p>
<p><code class="docutils literal notranslate"><span class="pre">app/l3fwd.py</span></code> launches l3fwd on a container.
As similar to <code class="docutils literal notranslate"><span class="pre">l3fwd</span></code> application, this python script takes several
options other than EAL for port configurations and classification methods.
The mandatory options for the application are <code class="docutils literal notranslate"><span class="pre">-p</span></code> for portmask
and <code class="docutils literal notranslate"><span class="pre">--config</span></code> for rx as a set of combination of
<code class="docutils literal notranslate"><span class="pre">(port,</span> <span class="pre">queue,</span> <span class="pre">locre)</span></code>.</p>
<p>Here is an example for launching l3fwd app container with two vhost
interfaces and printed log messages.
There are two rx ports. <code class="docutils literal notranslate"><span class="pre">(0,0,1)</span></code> is for queue of port 0 for which
lcore 1 is assigned, and <code class="docutils literal notranslate"><span class="pre">(1,0,2)</span></code> is for port 1.
In this case, you should add <code class="docutils literal notranslate"><span class="pre">-nq</span></code> option because the number of both
of rx and tx queues are two while the default number of virtio device
is one.
The number of tx queues, is two in this case, is decided to be the same
value as the number of lcores.
In <code class="docutils literal notranslate"><span class="pre">--vdev</span></code> option setup in the script, the number of queues is
defined as <code class="docutils literal notranslate"><span class="pre">virtio_...,queues=2,...</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/l3fwd.py -l <span class="m">1</span>-2 -nq <span class="m">2</span> -d vhost:1,vhost:2 <span class="se">\</span>
  -p 0x03 --config<span class="o">=</span><span class="s2">&quot;(0,0,1),(1,0,2)&quot;</span> -fg
<span class="go"> sudo docker run \</span>
<span class="go"> -it \</span>
<span class="go"> ...</span>
<span class="go"> --vdev virtio_user1,queues=2,path=/var/run/usvhost1 \</span>
<span class="go"> --vdev virtio_user2,queues=2,path=/var/run/usvhost2 \</span>
<span class="go"> --file-prefix spp-l3fwd-container1 \</span>
<span class="go"> -- \</span>
<span class="go"> -p 0x03 \</span>
<span class="go"> --config &quot;(0,0,8),(1,0,9)&quot; \</span>
<span class="go"> --parse-ptype ipv4</span>
<span class="go">EAL: Detected 16 lcore(s)</span>
<span class="go">EAL: Auto-detected process type: PRIMARY</span>
<span class="go">EAL: Multi-process socket /var/run/.spp-l3fwd-container1_unix</span>
<span class="go">EAL: Probing VFIO support...</span>
<span class="go">soft parse-ptype is enabled</span>
<span class="go">LPM or EM none selected, default LPM on</span>
<span class="go">Initializing port 0 ... Creating queues: nb_rxq=1 nb_txq=2...</span>
<span class="go">LPM: Adding route 0x01010100 / 24 (0)</span>
<span class="go">LPM: Adding route 0x02010100 / 24 (1)</span>
<span class="go">LPM: Adding route IPV6 / 48 (0)</span>
<span class="go">LPM: Adding route IPV6 / 48 (1)</span>
<span class="go">txq=8,0,0 txq=9,1,0</span>
<span class="go">Initializing port 1 ... Creating queues: nb_rxq=1 nb_txq=2...</span>

<span class="go">Initializing rx queues on lcore 8 ... rxq=0,0,0</span>
<span class="go">Initializing rx queues on lcore 9 ... rxq=1,0,0</span>
<span class="go">...</span>
</pre></div>
</div>
<p>You can increase lcores more than the number of ports, for instance,
four lcores for two ports.
However, remaining 3rd and 4th lcores do nothing and require
<code class="docutils literal notranslate"><span class="pre">-nq</span> <span class="pre">4</span></code> for tx queues.</p>
<p>Default classification rule is <code class="docutils literal notranslate"><span class="pre">LPM</span></code> and the routing table is defined
in <code class="docutils literal notranslate"><span class="pre">dpdk/examples/l3fwd/l3fwd_lpm.c</span></code> as below.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="k">struct</span> <span class="n">ipv4_l3fwd_lpm_route</span> <span class="n">ipv4_l3fwd_lpm_route_array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
        <span class="p">{</span><span class="n">IPv4</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">7</span><span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Refer help for all of options and usges.
It shows options without of EAL and container for simplicity.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/l3fwd.py -h
<span class="go">usage: l3fwd.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]] [-nq NOF_QUEUES]</span>
<span class="go">                [--no-privileged] [-p PORT_MASK] [--config CONFIG] [-P] [-E]</span>
<span class="go">                [-L] [-dst [ETH_DEST [ETH_DEST ...]]] [--enable-jumbo]</span>
<span class="go">                [--max-pkt-len MAX_PKT_LEN] [--no-numa] [--hash-entry-num]</span>
<span class="go">                [--ipv6] [--parse-ptype PARSE_PTYPE] [--dist-name DIST_NAME]</span>
<span class="go">                [--dist-ver DIST_VER] [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for l3fwd application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -p PORT_MASK, --port-mask PORT_MASK</span>
<span class="go">                        (Mandatory) Port mask</span>
<span class="go">  --config CONFIG       (Mandatory) Define set of port, queue, lcore for</span>
<span class="go">                        ports</span>
<span class="go">  -P, --promiscous      Set all ports to promiscous mode (default is None)</span>
<span class="go">  -E, --exact-match     Enable exact match (default is None)</span>
<span class="go">  -L, --longest-prefix-match</span>
<span class="go">                        Enable longest prefix match (default is None)</span>
<span class="go">  -dst [ETH_DEST [ETH_DEST ...]], --eth-dest [ETH_DEST [ETH_DEST ...]]</span>
<span class="go">                        Ethernet dest for port X (X,MM:MM:MM:MM:MM:MM)</span>
<span class="go">  --enable-jumbo        Enable jumbo frames, [--enable-jumbo [--max-pkt-len</span>
<span class="go">                        PKTLEN]]</span>
<span class="go">  --max-pkt-len MAX_PKT_LEN</span>
<span class="go">                        Max packet length (64-9600) if jumbo is enabled.</span>
<span class="go">  --no-numa             Disable NUMA awareness (default is None)</span>
<span class="go">  --hash-entry-num      Specify the hash entry number in hexadecimal</span>
<span class="go">                        (default is None)</span>
<span class="go">  --ipv6                Specify the hash entry number in hexadecimal</span>
<span class="go">                        (default is None)</span>
<span class="go">  --parse-ptype PARSE_PTYPE</span>
<span class="go">                        Set analyze packet type, ipv4 or ipv6 (default is</span>
<span class="go">                        ipv4)</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="l3fwd-acl-container">
<span id="sppc-appl-l3fwd-acl"></span><h2>1.5.6. L3fwd-acl Container<a class="headerlink" href="#l3fwd-acl-container" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://doc.dpdk.org/guides/sample_app_ug/l3_forward_access_ctrl.html">L3 Forwarding with Access Control</a>
application is a simple example of packet processing using the DPDK.
The application performs a security check on received packets.
Packets that are in the Access Control List (ACL), which is loaded
during initialization, are dropped. Others are forwarded to the correct
port.</p>
<p><code class="docutils literal notranslate"><span class="pre">app/l3fwd-acl.py</span></code> launches l3fwd-acl on a container.
As similar to <code class="docutils literal notranslate"><span class="pre">l3fwd-acl</span></code>, this python script takes several options
other than EAL for port configurations and rules.
The mandatory options for the application are <code class="docutils literal notranslate"><span class="pre">-p</span></code> for portmask
and <code class="docutils literal notranslate"><span class="pre">--config</span></code> for rx as a set of combination of
<code class="docutils literal notranslate"><span class="pre">(port,</span> <span class="pre">queue,</span> <span class="pre">locre)</span></code>.</p>
<p>Here is an example for launching l3fwd app container with two vhost
interfaces and printed log messages.
There are two rx ports. <code class="docutils literal notranslate"><span class="pre">(0,0,1)</span></code> is for queue of port 0 for which
lcore 1 is assigned, and <code class="docutils literal notranslate"><span class="pre">(1,0,2)</span></code> is for port 1.
In this case, you should add <code class="docutils literal notranslate"><span class="pre">-nq</span></code> option because the number of both
of rx and tx queues are two while the default number of virtio device
is one.
The number of tx queues, is two in this case, is decided to be the same
value as the number of lcores.
In <code class="docutils literal notranslate"><span class="pre">--vdev</span></code> option setup in the script, the number of queues is
defined as <code class="docutils literal notranslate"><span class="pre">virtio_...,queues=2,...</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/l3fwd-acl.py -l <span class="m">1</span>-2 -nq <span class="m">2</span> -d vhost:1,vhost:2 <span class="se">\</span>
  --rule_ipv4<span class="o">=</span><span class="s2">&quot;./rule_ipv4.db&quot;</span> --rule_ipv6<span class="o">=</span><span class="s2">&quot;./rule_ipv6.db&quot;</span> --scalar <span class="se">\</span>
  -p 0x03 --config<span class="o">=</span><span class="s2">&quot;(0,0,1),(1,0,2)&quot;</span> -fg
<span class="go"> sudo docker run \</span>
<span class="go"> -it \</span>
<span class="go"> ...</span>
<span class="go"> --vdev virtio_user1,queues=2,path=/var/run/usvhost1 \</span>
<span class="go"> --vdev virtio_user2,queues=2,path=/var/run/usvhost2 \</span>
<span class="go"> --file-prefix spp-l3fwd-container1 \</span>
<span class="go"> -- \</span>
<span class="go"> -p 0x03 \</span>
<span class="go"> --config &quot;(0,0,8),(1,0,9)&quot; \</span>
<span class="go"> --rule_ipv4=&quot;./rule_ipv4.db&quot; \</span>
<span class="go"> --rule_ipv6=&quot;./rule_ipv6.db&quot; \</span>
<span class="go"> --scalar</span>
<span class="go">EAL: Detected 16 lcore(s)</span>
<span class="go">EAL: Auto-detected process type: PRIMARY</span>
<span class="go">EAL: Multi-process socket /var/run/.spp-l3fwd-container1_unix</span>
<span class="go">EAL: Probing VFIO support...</span>
<span class="go">soft parse-ptype is enabled</span>
<span class="go">LPM or EM none selected, default LPM on</span>
<span class="go">Initializing port 0 ... Creating queues: nb_rxq=1 nb_txq=2...</span>
<span class="go">LPM: Adding route 0x01010100 / 24 (0)</span>
<span class="go">LPM: Adding route 0x02010100 / 24 (1)</span>
<span class="go">LPM: Adding route IPV6 / 48 (0)</span>
<span class="go">LPM: Adding route IPV6 / 48 (1)</span>
<span class="go">txq=8,0,0 txq=9,1,0</span>
<span class="go">Initializing port 1 ... Creating queues: nb_rxq=1 nb_txq=2...</span>

<span class="go">Initializing rx queues on lcore 8 ... rxq=0,0,0</span>
<span class="go">Initializing rx queues on lcore 9 ... rxq=1,0,0</span>
<span class="go">...</span>
</pre></div>
</div>
<p>You can increase lcores more than the number of ports, for instance,
four lcores for two ports.
However, remaining 3rd and 4th lcores do nothing and require
<code class="docutils literal notranslate"><span class="pre">-nq</span> <span class="pre">4</span></code> for tx queues.</p>
<p>Refer help for all of options and usges.
It shows options without of EAL and container for simplicity.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/l3fwd-acl.py -h
<span class="go">usage: l3fwd-acl.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                    [--socket-mem SOCKET_MEM]</span>
<span class="go">                    [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                    [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                    [--single-file-segment] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                    [-d DEV_IDS] [-nq NOF_QUEUES] [--no-privileged]</span>
<span class="go">                    [-p PORT_MASK] [--config CONFIG] [-P]</span>
<span class="go">                    [--rule_ipv4 RULE_IPV4] [--rule_ipv6 RULE_IPV6]</span>
<span class="go">                    [--scalar] [--enable-jumbo]</span>
<span class="go">                    [--max-pkt-len MAX_PKT_LEN] [--no-numa]</span>
<span class="go">                    [--dist-name DIST_NAME] [--dist-ver DIST_VER]</span>
<span class="go">                    [--workdir WORKDIR] [-ci CONTAINER_IMAGE] [-fg]</span>
<span class="go">                    [--dry-run]</span>

<span class="go">usage: l3fwd-acl.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                    [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                    [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                    [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                    [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                    [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]]</span>
<span class="go">                    [-nq NOF_QUEUES] [--no-privileged] [-p PORT_MASK]</span>
<span class="go">                    [--config CONFIG] [-P]</span>
<span class="go">                    [--rule_ipv4 RULE_IPV4] [--rule_ipv6 RULE_IPV6]</span>
<span class="go">                    [--scalar] [--enable-jumbo] [--max-pkt-len MAX_PKT_LEN]</span>
<span class="go">                    [--no-numa] [--dist-name DIST_NAME]</span>
<span class="go">                    [--dist-ver DIST_VER] [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                    [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for l3fwd-acl application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -p PORT_MASK, --port-mask PORT_MASK</span>
<span class="go">                        (Mandatory) Port mask</span>
<span class="go">  --config CONFIG       (Mandatory) Define set of port, queue, lcore for</span>
<span class="go">                        ports</span>
<span class="go">  -P, --promiscous      Set all ports to promiscous mode (default is None)</span>
<span class="go">  --rule_ipv4 RULE_IPV4</span>
<span class="go">                        Specifies the IPv4 ACL and route rules file</span>
<span class="go">  --rule_ipv6 RULE_IPV6</span>
<span class="go">                        Specifies the IPv6 ACL and route rules file</span>
<span class="go">  --scalar              Use a scalar function to perform rule lookup</span>
<span class="go">  --enable-jumbo        Enable jumbo frames, [--enable-jumbo [--max-pkt-len</span>
<span class="go">                        PKTLEN]]</span>
<span class="go">  --max-pkt-len MAX_PKT_LEN</span>
<span class="go">                        Max packet length (64-9600) if jumbo is enabled.</span>
<span class="go">  --no-numa             Disable NUMA awareness (default is None)</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="testpmd-container">
<span id="sppc-appl-testpmd"></span><h2>1.5.7. Testpmd Container<a class="headerlink" href="#testpmd-container" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">testpmd.py</span></code> is a launcher script for DPDK’s
<a class="reference external" href="https://dpdk.org/doc/guides/testpmd_app_ug/index.html">testpmd</a>
application.</p>
<p>It launches <code class="docutils literal notranslate"><span class="pre">testpmd</span></code> inside a container with specified
vhost interfaces.</p>
<p>This is an example for launching with three cores (6-8th cores)
and two vhost interfaces.
This example is for launching <code class="docutils literal notranslate"><span class="pre">testpmd</span></code> in interactive mode.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/testpmd.py -l <span class="m">6</span>-8 -d vhost:1,vhost:2 -fg -i
<span class="go"> sudo docker run \</span>
<span class="go"> ...</span>
<span class="go"> -- \</span>
<span class="go"> --interactive</span>
<span class="go"> ...</span>
<span class="go">Checking link statuses...</span>
<span class="go">Done</span>
<span class="go">testpmd&gt;</span>
</pre></div>
</div>
<p>Testpmd has many useful options. Please refer to
<a class="reference external" href="https://dpdk.org/doc/guides/testpmd_app_ug/run_app.html">Running the Application</a>
section for instructions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">testpmd.py</span></code> does not support all of options of testpmd currently.
You can find all of options with <code class="docutils literal notranslate"><span class="pre">-h</span></code> option, but some of them
is not implemented. If you run testpmd with not supported option,
It just prints an error message to mention.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/testpmd.py -l <span class="m">1</span>,2 -d vhost:1,vhost:2 <span class="se">\</span>
  --port-topology<span class="o">=</span>chained
<span class="go">Error: &#39;--port-topology&#39; is not supported yet</span>
</pre></div>
</div>
</div>
<p>Refer help for all of options and usges.
It shows options without of EAL and container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/testpmd.py -h
<span class="go">usage: testpmd.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                  [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                  [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                  [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                  [--single-file-segments]</span>
<span class="go">                  [--nof-memchan NOF_MEMCHAN] [-d DEV_UIDS]</span>
<span class="go">                  [-v [VOLUME [VOLUME ...]]]</span>
<span class="go">                  [-nq NOF_QUEUES] [--no-privileged] [--pci] [-i] [-a]</span>
<span class="go">                  [--tx-first] [--stats-period STATS_PERIOD]</span>
<span class="go">                  [--nb-cores NB_CORES] [--coremask COREMASK]</span>
<span class="go">                  [--portmask PORTMASK] [--no-numa]</span>
<span class="go">                  [--port-numa-config PORT_NUMA_CONFIG]</span>
<span class="go">                  [--ring-numa-config RING_NUMA_CONFIG]</span>
<span class="go">                  [--socket-num SOCKET_NUM] [--mbuf-size MBUF_SIZE]</span>
<span class="go">                  [--total-num-mbufs TOTAL_NUM_MBUFS]</span>
<span class="go">                  [--max-pkt-len MAX_PKT_LEN]</span>
<span class="go">                  [--eth-peers-configfile ETH_PEERS_CONFIGFILE]</span>
<span class="go">                  [--eth-peer ETH_PEER] [--pkt-filter-mode PKT_FILTER_MODE]</span>
<span class="go">                  [--pkt-filter-report-hash PKT_FILTER_REPORT_HASH]</span>
<span class="go">                  [--pkt-filter-size PKT_FILTER_SIZE]</span>
<span class="go">                  [--pkt-filter-flexbytes-offset PKT_FILTER_FLEXBYTES_OFFSET]</span>
<span class="go">                  [--pkt-filter-drop-queue PKT_FILTER_DROP_QUEUE]</span>
<span class="go">                  [--disable-crc-strip] [--enable-lro] [--enable-rx-cksum]</span>
<span class="go">                  [--enable-scatter] [--enable-hw-vlan]</span>
<span class="go">                  [--enable-hw-vlan-filter]</span>
<span class="go">                  [--enable-hw-vlan-strip] [--enable-hw-vlan-extend]</span>
<span class="go">                  [--enable-drop-en] [--disable-rss]</span>
<span class="go">                  [--port-topology PORT_TOPOLOGY]</span>
<span class="go">                  [--forward-mode FORWARD_MODE] [--rss-ip] [--rss-udp]</span>
<span class="go">                  [--rxq RXQ] [--rxd RXD] [--txq TXQ] [--txd TXD]</span>
<span class="go">                  [--burst BURST] [--mbcache MBCACHE]</span>
<span class="go">                  [--rxpt RXPT] [--rxht RXHT] [--rxfreet RXFREET]</span>
<span class="go">                  [--rxwt RXWT] [--txpt TXPT] [--txht TXHT] [--txwt TXWT]</span>
<span class="go">                  [--txfreet TXFREET] [--txrst TXRST]</span>
<span class="go">                  [--rx-queue-stats-mapping RX_QUEUE_STATS_MAPPING]</span>
<span class="go">                  [--tx-queue-stats-mapping TX_QUEUE_STATS_MAPPING]</span>
<span class="go">                  [--no-flush-rx] [--txpkts TXPKTS]</span>
<span class="go">                  [--disable-link-check] [--no-lsc-interrupt]</span>
<span class="go">                  [--no-rmv-interrupt]</span>
<span class="go">                  [--bitrate-stats [BITRATE_STATS [BITRATE_STATS ...]]]</span>
<span class="go">                  [--print-event PRINT_EVENT] [--mask-event MASK_EVENT]</span>
<span class="go">                  [--flow-isolate-all] [--tx-offloads TX_OFFLOADS]</span>
<span class="go">                  [--hot-plug] [--vxlan-gpe-port VXLAN_GPE_PORT]</span>
<span class="go">                  [--mlockall] [--no-mlockall]</span>
<span class="go">                  [--dist-name DIST_NAME] [--dist-ver DIST_VER]</span>
<span class="go">                  [--workdir WORKDIR]</span>
<span class="go">                  [--name NAME] [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for testpmd application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  --pci                 Enable PCI (default is None)</span>
<span class="go">  -i, --interactive     Run in interactive mode (default is None)</span>
<span class="go">  -a, --auto-start      Start forwarding on initialization (default ...)</span>
<span class="go">  --tx-first            Start forwarding, after sending a burst of packets</span>
<span class="go">                        first</span>
<span class="go">  --stats-period STATS_PERIOD</span>
<span class="go">                        Period of displaying stats, if interactive is</span>
<span class="go">                        disabled</span>
<span class="go">  --nb-cores NB_CORES   Number of forwarding cores</span>
<span class="go">  --coremask COREMASK   Hexadecimal bitmask of the cores, do not include</span>
<span class="go">                        master lcore</span>
<span class="go">  --portmask PORTMASK   Hexadecimal bitmask of the ports</span>
<span class="go">  --no-numa             Disable NUMA-aware allocation of RX/TX rings and RX</span>
<span class="go">                        mbuf</span>
<span class="go">  --port-numa-config PORT_NUMA_CONFIG</span>
<span class="go">                        Specify port allocation as</span>
<span class="go">                        (port,socket)[,(port,socket)]</span>
<span class="go">  --ring-numa-config RING_NUMA_CONFIG</span>
<span class="go">                        Specify ring allocation as</span>
<span class="go">                        (port,flag,socket)[,(port,flag,socket)]</span>
<span class="go">  --socket-num SOCKET_NUM</span>
<span class="go">                        Socket from which all memory is allocated in NUMA</span>
<span class="go">                        mode</span>
<span class="go">  --mbuf-size MBUF_SIZE</span>
<span class="go">                        Size of mbufs used to N (&lt; 65536) bytes (default is</span>
<span class="go">                        2048)</span>
<span class="go">  --total-num-mbufs TOTAL_NUM_MBUFS</span>
<span class="go">                        Number of mbufs allocated in mbuf pools, N &gt; 1024.</span>
<span class="go">  --max-pkt-len MAX_PKT_LEN</span>
<span class="go">                        Maximum packet size to N (&gt;= 64) bytes (default is</span>
<span class="go">                        1518)</span>
<span class="go">  --eth-peers-configfile ETH_PEERS_CONFIGFILE</span>
<span class="go">                        Config file of Ether addrs of the peer ports</span>
<span class="go">  --eth-peer ETH_PEER   Set MAC addr of port N as &#39;N,XX:XX:XX:XX:XX:XX&#39;</span>
<span class="go">  --pkt-filter-mode PKT_FILTER_MODE</span>
<span class="go">                        Flow Director mode, &#39;none&#39;(default), &#39;signature&#39; or</span>
<span class="go">                        &#39;perfect&#39;</span>
<span class="go">  --pkt-filter-report-hash PKT_FILTER_REPORT_HASH</span>
<span class="go">                        Flow Director hash match mode, &#39;none&#39;,</span>
<span class="go">                        &#39;match&#39;(default) or &#39;always&#39;</span>
<span class="go">  --pkt-filter-size PKT_FILTER_SIZE</span>
<span class="go">                        Flow Director memory size (&#39;64K&#39;, &#39;128K&#39;, &#39;256K&#39;).</span>
<span class="go">                        The default is 64K.</span>
<span class="go">  --pkt-filter-flexbytes-offset PKT_FILTER_FLEXBYTES_OFFSET</span>
<span class="go">                        Flexbytes offset (0-32, default is 0x6) defined in</span>
<span class="go">                        words counted from the first byte of the dest MAC</span>
<span class="go">                        address</span>
<span class="go">  --pkt-filter-drop-queue PKT_FILTER_DROP_QUEUE</span>
<span class="go">                        Set the drop-queue (default is 127)</span>
<span class="go">  --disable-crc-strip   Disable hardware CRC stripping</span>
<span class="go">  --enable-lro          Enable large receive offload</span>
<span class="go">  --enable-rx-cksum     Enable hardware RX checksum offload</span>
<span class="go">  --enable-scatter      Enable scatter (multi-segment) RX</span>
<span class="go">  --enable-hw-vlan      Enable hardware vlan (default is None)</span>
<span class="go">  --enable-hw-vlan-filter</span>
<span class="go">                        Enable hardware VLAN filter</span>
<span class="go">  --enable-hw-vlan-strip</span>
<span class="go">                        Enable hardware VLAN strip</span>
<span class="go">  --enable-hw-vlan-extend</span>
<span class="go">                        Enable hardware VLAN extend</span>
<span class="go">  --enable-drop-en      Enable per-queue packet drop if no descriptors</span>
<span class="go">  --disable-rss         Disable RSS (Receive Side Scaling</span>
<span class="go">  --port-topology PORT_TOPOLOGY</span>
<span class="go">                        Port topology, &#39;paired&#39; (the default) or &#39;chained&#39;</span>
<span class="go">  --forward-mode FORWARD_MODE</span>
<span class="go">                        Forwarding mode, &#39;io&#39; (default), &#39;mac&#39;, &#39;mac_swap&#39;,</span>
<span class="go">                        &#39;flowgen&#39;, &#39;rxonly&#39;, &#39;txonly&#39;, &#39;csum&#39;, &#39;icmpecho&#39;,</span>
<span class="go">                        &#39;ieee1588&#39;, &#39;tm&#39;</span>
<span class="go">  --rss-ip              Set RSS functions for IPv4/IPv6 only</span>
<span class="go">  --rss-udp             Set RSS functions for IPv4/IPv6 and UDP</span>
<span class="go">  --rxq RXQ             Number of RX queues per port, 1-65535 (default ...)</span>
<span class="go">  --rxd RXD             Number of descriptors in the RX rings</span>
<span class="go">                        (default is 128)</span>
<span class="go">  --txq TXQ             Number of TX queues per port, 1-65535 (default ...)</span>
<span class="go">  --txd TXD             Number of descriptors in the TX rings</span>
<span class="go">                        (default is 512)</span>
<span class="go">  --burst BURST         Number of packets per burst, 1-512 (default is 32)</span>
<span class="go">  --mbcache MBCACHE     Cache of mbuf memory pools, 0-512 (default is 16)</span>
<span class="go">  --rxpt RXPT           Prefetch threshold register of RX rings</span>
<span class="go">                        (default is 8)</span>
<span class="go">  --rxht RXHT           Host threshold register of RX rings (default is 8)</span>
<span class="go">  --rxfreet RXFREET     Free threshold of RX descriptors,0-&#39;rxd&#39; (...)</span>
<span class="go">  --rxwt RXWT           Write-back threshold register of RX rings</span>
<span class="go">                        (default is 4)</span>
<span class="go">  --txpt TXPT           Prefetch threshold register of TX rings (...)</span>
<span class="go">  --txht TXHT           Host threshold register of TX rings (default is 0)</span>
<span class="go">  --txwt TXWT           Write-back threshold register of TX rings (...)</span>
<span class="go">  --txfreet TXFREET     Free threshold of RX descriptors, 0-&#39;txd&#39; (...)</span>
<span class="go">  --txrst TXRST         Transmit RS bit threshold of TX rings, 0-&#39;txd&#39;</span>
<span class="go">                        (default is 0)</span>
<span class="go">  --rx-queue-stats-mapping RX_QUEUE_STATS_MAPPING</span>
<span class="go">                        RX queues statistics counters mapping 0-15 as</span>
<span class="go">                        &#39;(port,queue,mapping)[,(port,queue,mapping)]&#39;</span>
<span class="go">  --tx-queue-stats-mapping TX_QUEUE_STATS_MAPPING</span>
<span class="go">                        TX queues statistics counters mapping 0-15 as</span>
<span class="go">                        &#39;(port,queue,mapping)[,(port,queue,mapping)]&#39;</span>
<span class="go">  --no-flush-rx         Don’t flush the RX streams before starting</span>
<span class="go">                        forwarding, Used mainly with the PCAP PMD</span>
<span class="go">  --txpkts TXPKTS       TX segment sizes or total packet length, Valid for</span>
<span class="go">                        tx-only and flowgen</span>
<span class="go">  --disable-link-check  Disable check on link status when starting/stopping</span>
<span class="go">                        ports</span>
<span class="go">  --no-lsc-interrupt    Disable LSC interrupts for all ports</span>
<span class="go">  --no-rmv-interrupt    Disable RMV interrupts for all ports</span>
<span class="go">  --bitrate-stats [BITRATE_STATS [BITRATE_STATS ...]]</span>
<span class="go">                        Logical core N to perform bitrate calculation</span>
<span class="go">  --print-event PRINT_EVENT</span>
<span class="go">                        Enable printing the occurrence of the designated</span>
<span class="go">                        event, &lt;unknown|intr_lsc|queue_state|intr_reset|</span>
<span class="go">                        vf_mbox|macsec|intr_rmv|dev_probed|dev_released|</span>
<span class="go">                        all&gt;</span>
<span class="go">  --mask-event MASK_EVENT</span>
<span class="go">                        Disable printing the occurrence of the designated</span>
<span class="go">                        event, &lt;unknown|intr_lsc|queue_state|intr_reset|</span>
<span class="go">                        vf_mbox|macsec|intr_rmv|dev_probed|dev_released|</span>
<span class="go">                        all&gt;</span>
<span class="go">  --flow-isolate-all    Providing this parameter requests flow API isolated</span>
<span class="go">                        mode on all ports at initialization time</span>
<span class="go">  --tx-offloads TX_OFFLOADS</span>
<span class="go">                        Hexadecimal bitmask of TX queue offloads (default</span>
<span class="go">                        is 0)</span>
<span class="go">  --hot-plug            Enable device event monitor machenism for hotplug</span>
<span class="go">  --vxlan-gpe-port VXLAN_GPE_PORT</span>
<span class="go">                        UDP port number of tunnel VXLAN-GPE (default is</span>
<span class="go">                        4790)</span>
<span class="go">  --mlockall            Enable locking all memory</span>
<span class="go">  --no-mlockall         Disable locking all memory</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="pktgen-dpdk-container">
<span id="sppc-appl-pktgen"></span><h2>1.5.8. Pktgen-dpdk Container<a class="headerlink" href="#pktgen-dpdk-container" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> is a launcher script for
<a class="reference external" href="http://pktgen-dpdk.readthedocs.io/en/latest/index.html">pktgen-dpdk</a>.
Pktgen is a software based traffic generator powered by the DPDK
fast packet processing framework.
It is not only high-performance for generating 10GB traffic with
64 byte frames, but also very configurable to handle packets with
UDP, TCP, ARP, ICMP, GRE, MPLS and Queue-in-Queue.
It also supports
<a class="reference external" href="https://www.lua.org/">Lua</a>
for detailed configurations.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> script launches <code class="docutils literal notranslate"><span class="pre">pktgen</span></code> app container
with specified vhost interfaces.
Here is an example for launching with seven lcores (8-14th)
and three vhost interfaces.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/pktgen.py -l <span class="m">8</span>-14 -d vhost:1,vhost:2,vhost:3 <span class="se">\</span>
  -fg
<span class="go"> sudo docker run \</span>
<span class="go"> ...</span>
<span class="go"> sppc/pktgen-ubuntu:latest \</span>
<span class="go"> /root/dpdk/../pktgen-dpdk/app/x86_64-native-linuxapp-gcc/pktgen \</span>
<span class="go"> -l 8-14 \</span>
<span class="go"> ...</span>
<span class="go"> -- \</span>
<span class="go"> -m [9:10].0,[11:12].1,[13:14].2</span>
<span class="go"> ...</span>
</pre></div>
</div>
<p>You notice that given lcores <code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">8-14</span></code> are assigned appropriately.
Lcore 8 is used as master and remaining six lcores are use to worker
threads for three ports as <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">[9:10].0,[11:12].1,[13:14].2</span></code> equally.
If the number of given lcores is larger than required,
remained lcores are simply not used.</p>
<p>Calculation of core assignment of <code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> currently is supporting
up to four lcores for each of ports.
If you assign fire or more lcores to a port, <code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> terminates
to launch app container.
It is because a usecase more than four lcores is rare and
calculation is to be complicated.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">#</span> Assign five lcores <span class="k">for</span> a slave is failed to launch
<span class="gp">$</span> python3 app/pktgen.py -l <span class="m">6</span>-11 -d vhost:1
<span class="go">Error: Too many cores for calculation for port assignment!</span>
<span class="go">Please consider to use &#39;--matrix&#39; for assigning directly</span>
</pre></div>
</div>
<p>Here are other examples of lcore assignment of <code class="docutils literal notranslate"><span class="pre">pktgen.py</span></code> to help
your understanding.</p>
<p><strong>1. Three lcores for two ports</strong></p>
<p>Assign one lcore to master and two lcores two slaves for two ports.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/pktgen.py -l <span class="m">6</span>-8 -d vhost:1,vhost:2
<span class="go"> ...</span>
<span class="go"> -m 7.0,8.1 \</span>
</pre></div>
</div>
<p><strong>2. Seven lcores for three ports</strong></p>
<p>Assign one lcore for master and each of two lcores to
three slaves for three ports.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/pktgen.py -l <span class="m">6</span>-12 -d vhost:1,vhost:2,vhost:3
<span class="go"> ...</span>
<span class="go"> -m [7:8].0,[9:10].1,[11:12].2 \</span>
</pre></div>
</div>
<p><strong>3. Seven lcores for two ports</strong></p>
<p>Assign one lcore for master and each of three lcores to
two slaves for two ports.
In this case, each of three lcores cannot be assigned rx and tx port
equally, so given two lcores to rx and one core to tx.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/pktgen.py -l <span class="m">6</span>-12 -d vhost:1,vhost:2
<span class="go"> ...</span>
<span class="go"> -m [7-8:9].0,[10-11:12].1 \</span>
</pre></div>
</div>
<p>Refer help for all of options and usges.
It shows options without of EAL and container for simplicity.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/pktgen.py -h
<span class="go">usage: pktgen.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                 [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                 [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                 [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                 [--single-file-segments] [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                 [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]]</span>
<span class="go">                 [-nq NOF_QUEUES] [--no-privileged] [-s PCAP_FILE]</span>
<span class="go">                 [-f SCRIPT_FILE]</span>
<span class="go">                 [-lf LOG_FILE] [-P] [-G] [-g SOCK_ADDRESS] [-T] [-N]</span>
<span class="go">                 [--matrix MATRIX] [--dist-name DIST_NAME]</span>
<span class="go">                 [--dist-ver DIST_VER]</span>
<span class="go">                 [--workdir WORKDIR] [--name NAME] [-ci CONTAINER_IMAGE]</span>
<span class="go">                 [-fg] [--dry-run]</span>

<span class="go">Launcher for pktgen-dpdk application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -s PCAP_FILE, --pcap-file PCAP_FILE</span>
<span class="go">                        PCAP packet flow file of port, defined as</span>
<span class="go">                        &#39;N:filename&#39;</span>
<span class="go">  -f SCRIPT_FILE, --script-file SCRIPT_FILE</span>
<span class="go">                        Pktgen script (.pkt) to or a Lua script (.lua)</span>
<span class="go">  -lf LOG_FILE, --log-file LOG_FILE</span>
<span class="go">                        Filename to write a log, as &#39;-l&#39; of pktgen</span>
<span class="go">  -P, --promiscuous     Enable PROMISCUOUS mode on all ports</span>
<span class="go">  -G, --sock-default    Enable socket support using default server values</span>
<span class="go">                        of localhost:0x5606</span>
<span class="go">  -g SOCK_ADDRESS, --sock-address SOCK_ADDRESS</span>
<span class="go">                        Same as -G but with an optional IP address and port</span>
<span class="go">                        number</span>
<span class="go">  -T, --term-color      Enable color terminal output in VT100</span>
<span class="go">  -N, --numa            Enable NUMA support</span>
<span class="go">  --matrix MATRIX       Matrix of cores and port as &#39;-m&#39; of pktgen, such as</span>
<span class="go">                        [1:2].0 or 1.0</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="load-balancer-container">
<span id="sppc-appl-load-balancer"></span><h2>1.5.9. Load-Balancer Container<a class="headerlink" href="#load-balancer-container" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://dpdk.org/doc/guides/sample_app_ug/load_balancer.html">Load-Balancer</a>
is an application distributes packet I/O task with several worker
lcores to share IP addressing.</p>
<p>There are three types of lcore roles in this application, rx, tx and
worker lcores. Rx lcores retrieve packets from NICs and Tx lcores
send it to the destinations.
Worker lcores intermediate them, receive packets from rx lcores,
classify by looking up the address and send it to each of destination
tx lcores.
Each of lcores has a set of references of lcore ID and queue
as described in <a class="reference external" href="https://dpdk.org/doc/guides/sample_app_ug/load_balancer.html#explanation">Application Configuration</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">load-balancer.py</span></code> expects four mandatory options.</p>
<blockquote>
<div><ul class="simple">
<li><p>-rx: “(PORT, QUEUE, LCORE), …”, list of NIC RX ports and
queues handled by the I/O RX lcores. This parameter also implicitly
defines the list of I/O RX lcores.</p></li>
<li><p>-tx: “(PORT, LCORE), …”, list of NIC TX ports handled by
the I/O TX lcores. This parameter also implicitly defines the list
of I/O TX lcores.</p></li>
<li><p>-w: The list of the worker lcores.</p></li>
<li><p>–lpm: “IP / PREFIX =&gt; PORT”, list of LPM rules used by the worker
lcores for packet forwarding.</p></li>
</ul>
</div></blockquote>
<p>Here is an example for one rx, one tx and two worker on lcores 8-10.
Both of rx and rx is assinged to the same lcore 8.
It receives packets from port 0 and forwards it port 0 or 1.
The destination port is defined as <code class="docutils literal notranslate"><span class="pre">--lpm</span></code> option.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/load-balancer.py -fg -l <span class="m">8</span>-10  -d vhost:1,vhost:2 <span class="se">\</span>
  -rx <span class="s2">&quot;(0,0,8)&quot;</span> -tx <span class="s2">&quot;(0,8),(1,8)&quot;</span> -w <span class="m">9</span>,10 <span class="se">\</span>
  --lpm <span class="s2">&quot;1.0.0.0/24=&gt;0; 1.0.1.0/24=&gt;1;&quot;</span>
</pre></div>
</div>
<p>If you are succeeded to launch the app container,
it shows details of rx, tx, worker lcores and LPM rules
, and starts forwarding.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">...</span>
<span class="go">Checking link statusdone</span>
<span class="go">Port0 Link Up - speed 10000Mbps - full-duplex</span>
<span class="go">Port1 Link Up - speed 10000Mbps - full-duplex</span>
<span class="go">Initialization completed.</span>
<span class="go">NIC RX ports: 0 (0 )  ;</span>
<span class="go">I/O lcore 8 (socket 0): RX ports  (0, 0)  ; Output rings  0x7f9af7347...</span>
<span class="go">Worker lcore 9 (socket 0) ID 0: Input rings  0x7f9af7347880  ;</span>
<span class="go">Worker lcore 10 (socket 0) ID 1: Input rings  0x7f9af7345680  ;</span>

<span class="go">NIC TX ports:  0  1  ;</span>
<span class="go">I/O lcore 8 (socket 0): Input rings per TX port  0 (0x7f9af7343480 ...</span>
<span class="go">Worker lcore 9 (socket 0) ID 0:</span>
<span class="go">Output rings per TX port  0 (0x7f9af7343480)  1 (0x7f9af7341280)  ;</span>
<span class="go">Worker lcore 10 (socket 0) ID 1:</span>
<span class="go">Output rings per TX port  0 (0x7f9af733f080)  1 (0x7f9af733ce80)  ;</span>
<span class="go">LPM rules:</span>
<span class="go">    0: 1.0.0.0/24 =&gt; 0;</span>
<span class="go">    1: 1.0.1.0/24 =&gt; 1;</span>
<span class="go">Ring sizes: NIC RX = 1024; Worker in = 1024; Worker out = 1024; NIC TX...</span>
<span class="go">Burst sizes: I/O RX (rd = 144, wr = 144); Worker (rd = 144, wr = 144);...</span>
<span class="go">Logical core 9 (worker 0) main loop.</span>
<span class="go">Logical core 10 (worker 1) main loop.</span>
<span class="go">Logical core 8 (I/O) main loop.</span>
</pre></div>
</div>
<p>To stop forwarding, you need to terminate the application
but might not able to with <em>Ctrl-C</em>.
In this case, you can use <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">kill</span></code> command to terminate it.
Find the name of container on which <code class="docutils literal notranslate"><span class="pre">load_balancer</span></code> is running
and kill it.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker ps
<span class="go">CONTAINER ID  IMAGE                   ...  NAMES</span>
<span class="go">80ce3711b85e  sppc/dpdk-ubuntu:latest ...  competent_galileo  # kill it</span>
<span class="go">281aa8f236ef  sppc/spp-ubuntu:latest  ...  youthful_mcnulty</span>
<span class="gp">$</span> docker <span class="nb">kill</span> competent_galileo
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You shold care about the number of worker lcores. If you add lcore 11
and assign it for third worker thread,
it is failed to lauhch the application.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">...</span>
<span class="go">EAL: Probing VFIO support...</span>
<span class="go">Incorrect value for --w argument (-8)</span>

<span class="go">    load_balancer &lt;EAL PARAMS&gt; -- &lt;APP PARAMS&gt;</span>

<span class="go">Application manadatory parameters:</span>
<span class="go">    --rx &quot;(PORT, QUEUE, LCORE), ...&quot; : List of NIC RX ports and queues</span>
<span class="go">           handled by the I/O RX lcores</span>
<span class="go">...</span>
</pre></div>
</div>
<p>The reason is the number of lcore is considered as invalid in
<code class="docutils literal notranslate"><span class="pre">parse_arg_w()</span></code> as below.
<code class="docutils literal notranslate"><span class="pre">n_tuples</span></code> is the number of lcores and it should be
<cite>2^n</cite>, or returned with error code.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Defined in dpdk/examples/load_balancer/config.c</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">parse_arg_w</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">arg</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">n_tuples</span><span class="p">;</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">n_tuples</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n_tuples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">8</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="p">...</span>
</pre></div>
</div>
</div>
<p>Here are other examples.</p>
<p><strong>1. Separate rx and tx lcores</strong></p>
<p>Use four lcores 8-11 for rx, tx and two worker threads.
The number of ports is same as the previous example.
You notice that rx and tx have different lcore number, 8 and 9.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/load-balancer.py -fg -l <span class="m">8</span>-11 -d vhost:1,vhost:2 <span class="se">\</span>
  -rx <span class="s2">&quot;(0,0,8)&quot;</span> <span class="se">\</span>
  -tx <span class="s2">&quot;(0,9),(1,9)&quot;</span> <span class="se">\</span>
  -w <span class="m">10</span>,11 <span class="se">\</span>
  --lpm <span class="s2">&quot;1.0.0.0/24=&gt;0; 1.0.1.0/24=&gt;1;&quot;</span>
</pre></div>
</div>
<p><strong>2. Assign multiple queues for rx</strong></p>
<p>To classify for three destination ports, use one rx lcore,
three tx lcores and four worker lcores.
In this case, rx has two queues and using <code class="docutils literal notranslate"><span class="pre">-nq</span> <span class="pre">2</span></code>.
You should start queue ID from 0 and to be in serial as <cite>0,1,2,…</cite>,
or failed to launch.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/load-balancer.py -fg -l <span class="m">8</span>-13 <span class="se">\</span>
  -d vhost:1,vhost:2,vhost:3 <span class="se">\</span>
  -nq <span class="m">2</span> <span class="se">\</span>
  -rx <span class="s2">&quot;(0,0,8),(0,1,8)&quot;</span> <span class="se">\</span>
  -tx <span class="s2">&quot;(0,9),(1,9),(2,9)&quot;</span> <span class="se">\</span>
  -w <span class="m">10</span>,11,12,13 <span class="se">\</span>
  --lpm <span class="s2">&quot;1.0.0.0/24=&gt;0; 1.0.1.0/24=&gt;1; 1.0.2.0/24=&gt;2;&quot;</span>
</pre></div>
</div>
<p>Refer options and usages by <code class="docutils literal notranslate"><span class="pre">load-balancer.py</span> <span class="pre">-h</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/load-balancer.py -h
<span class="go">usage: load-balancer.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                        [--vdev [VDEV [VDEV ...]]]</span>
<span class="go">                        [--socket-mem SOCKET_MEM]</span>
<span class="go">                        [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                        [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                        [--single-file-segments]</span>
<span class="go">                        [--nof-memchan NOF_MEMCHAN]</span>
<span class="go">                        [-d DEV_UIDS] [-v [VOLUME [VOLUME ...]]]</span>
<span class="go">                        [-nq NOF_QUEUES] [--no-privileged]</span>
<span class="go">                        [-rx RX_PORTS] [-tx TX_PORTS] [-wl WORKER_LCORES]</span>
<span class="go">                        [-rsz RING_SIZES] [-bsz BURST_SIZES]</span>
<span class="go">                        [--lpm LPM] [--pos-lb POS_LB]</span>
<span class="go">                        [--dist-name DIST_NAME] [--dist-ver DIST_VER]</span>
<span class="go">                        [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                        [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for load-balancer application container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  -rx RX_PORTS, --rx-ports RX_PORTS</span>
<span class="go">                        List of rx ports and queues handled by the I/O rx</span>
<span class="go">                        lcores</span>
<span class="go">  -tx TX_PORTS, --tx-ports TX_PORTS</span>
<span class="go">                        List of tx ports and queues handled by the I/O tx</span>
<span class="go">                        lcores</span>
<span class="go">  -w WORKER_LCORES, --worker-lcores WORKER_LCORES</span>
<span class="go">                        List of worker lcores</span>
<span class="go">  -rsz RING_SIZES, --ring-sizes RING_SIZES</span>
<span class="go">                        Ring sizes of &#39;rx_read,rx_send,w_send,tx_written&#39;</span>
<span class="go">  -bsz BURST_SIZES, --burst-sizes BURST_SIZES</span>
<span class="go">                        Burst sizes of rx, worker or tx</span>
<span class="go">  --lpm LPM             List of LPM rules</span>
<span class="go">  --pos-lb POS_LB       Position of the 1-byte field used for identify</span>
<span class="go">                        worker</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="suricata-container">
<span id="sppc-appl-suricata"></span><h2>1.5.10. Suricata Container<a class="headerlink" href="#suricata-container" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://suricata.readthedocs.io/en/suricata-4.1.2/index.html">Suricata</a>
is a sophisticated IDS/IPS application.
SPP container supports suricata 4.1.4 hosted this
<a class="reference external" href="https://github.com/vipinpv85/DPDK_SURICATA-4_1_1">repository</a>.</p>
<p>Unlike other scripts, <code class="docutils literal notranslate"><span class="pre">app/suricata.py</span></code> does not launch appliation
directly but bash to enable to edit config file on the container.
Suricata accepts options from config file specified with
<code class="docutils literal notranslate"><span class="pre">--dpdk</span></code> option.
You can copy your config to the container by using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">cp</span></code>.
Sample config <code class="docutils literal notranslate"><span class="pre">mysuricata.cfg</span></code> is included under <code class="docutils literal notranslate"><span class="pre">suricata-4.1.4</span></code>.</p>
<p>Here is an example of launching suricata with image
<code class="docutils literal notranslate"><span class="pre">sppc/suricata-ubuntu2:latest</span></code>
which is built as described in
<a class="reference internal" href="build_img.html#sppc-build-img-suricata"><span class="std std-ref">Build suricata image</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> docker cp your.cnf CONTAINER_ID:/path/to/conf/your.conf
<span class="gp">$</span> ./suricata.py -d vhost:1,vhost:2 -fg -ci sppc/suricata-ubuntu2:latest
<span class="gp">#</span> suricata --dpdk<span class="o">=</span>/path/to/config
</pre></div>
</div>
<p>Refer options and usages by <code class="docutils literal notranslate"><span class="pre">load-balancer.py</span> <span class="pre">-h</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python3 app/suricata.py -h
<span class="go">usage: suricata.py [-h] [-l CORE_LIST] [-c CORE_MASK] [-m MEM]</span>
<span class="go">                   [--vdev [VDEV [VDEV ...]]] [--socket-mem SOCKET_MEM]</span>
<span class="go">                   [-b [PCI_BLACKLIST [PCI_BLACKLIST ...]]]</span>
<span class="go">                   [-w [PCI_WHITELIST [PCI_WHITELIST ...]]]</span>
<span class="go">                   [--single-file-segments]</span>
<span class="go">                   [--nof-memchan NOF_MEMCHAN] [-d DEV_UIDS]</span>
<span class="go">                   [-v [VOLUME [VOLUME ...]]] [-nq NOF_QUEUES]</span>
<span class="go">                   [--no-privileged]</span>
<span class="go">                   [--dist-name DIST_NAME] [--dist-ver DIST_VER]</span>
<span class="go">                   [--workdir WORKDIR] [--name NAME]</span>
<span class="go">                   [-ci CONTAINER_IMAGE] [-fg] [--dry-run]</span>

<span class="go">Launcher for suricata container</span>

<span class="go">optional arguments:</span>
<span class="go">  ...</span>
<span class="go">  -d DEV_UIDS, --dev-uids DEV_UIDS</span>
<span class="go">                        Virtual devices of SPP in resource UID format</span>
<span class="go">  -nq NOF_QUEUES, --nof-queues NOF_QUEUES</span>
<span class="go">                        Number of queues of virtio (default is 1)</span>
<span class="go">  --no-privileged       Disable docker&#39;s privileged mode if it&#39;s needed</span>
<span class="go">  --dist-name DIST_NAME</span>
<span class="go">                        Name of Linux distribution</span>
<span class="go">  ...</span>
</pre></div>
</div>
</div>
<div class="section" id="helloworld-container">
<span id="sppc-appl-helloworld"></span><h2>1.5.11. Helloworld Container<a class="headerlink" href="#helloworld-container" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://dpdk.org/doc/guides/sample_app_ug/hello_world.html">helloworld</a>
sample application is an example of the simplest DPDK application
that can be written.</p>
<p>Unlike from the other applications, it does not work as a network
function actually.
This app container script <code class="docutils literal notranslate"><span class="pre">helloworld.py</span></code> is intended to be used
as a template for an user defined app container script.
You can use it as a template for developing your app container script.
An instruction for developing app container script is described in
<a class="reference internal" href="howto_launcher.html#sppc-howto-define-appc"><span class="std std-ref">How to Define Your App Launcher</span></a>.</p>
<p>Helloworld app container has no application specific options. There are
only EAL and app container options.
You should give <code class="docutils literal notranslate"><span class="pre">-l</span></code> option for the simplest app container.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /path/to/spp/tools/sppc
<span class="gp">$</span> python3 app/helloworld.py -l <span class="m">4</span>-6 -fg
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usecases.html" class="btn btn-neutral float-right" title="1.6. Use Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build_img.html" class="btn btn-neutral float-left" title="1.4. Build Images" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>